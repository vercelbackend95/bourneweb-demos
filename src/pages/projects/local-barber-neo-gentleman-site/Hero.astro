---
import "./_hero.css";

const {
  kicker = "NEO GENTLEMAN · PREMIUM BARBERSHOP",
  punchline = "Precision, not speed.",
  titleLine1 = "Sharp fades.",
  titleLine2 = "Calm ritual.",
  lead = "Crafted cuts, clean lines — hot towel finish included. Pick a service and we’ll line up the best slot.",
  openHours = "10:00–20:00",
  proof1 = "3000+ cuts",

  photoUrl = "https://images.unsplash.com/photo-1599351431618-3174d19c93a5?auto=format&fit=crop&w=2400&q=80",
  textureUrl = "https://images.unsplash.com/photo-1585747860715-2ba37e788b70?auto=format&fit=crop&w=2400&q=80",
} = Astro.props;
---

<main class="bm-hero" aria-label="Barber hero" data-bm-hero>
  <div class="bm-hero__bg" aria-hidden="true"></div>

  <div class="bm-hero__grid">
    <!-- LEFT -->
    <section class="bm-hero__copy">
      <p class="bm-kicker">{kicker}</p>
      <p class="bm-punchline">{punchline}</p>

      <div class="bm-openNow" aria-label="Open today">
        <span class="bm-openDot" aria-hidden="true"></span>
        <span class="bm-openTxt">Open today <strong>{openHours}</strong></span>
      </div>

      <h1 class="bm-title">
        {titleLine1}<br />
        {titleLine2}
      </h1>

      <p class="bm-lead">{lead}</p>

      <div class="bm-actions">
        <a class="bm-cta" href="#book">
          Book now
          <span class="bm-cta__shine" aria-hidden="true"></span>
        </a>

        <a class="bm-linkPlain" href="#services">
          View services <span class="bm-linkPlain__arrow" aria-hidden="true">↗</span>
        </a>
      </div>

      <div class="bm-rating" aria-label="Google rating & proof">
        <span class="bm-rating__stars" aria-hidden="true">★★★★★</span>
        <span class="bm-rating__val"><strong>4.9</strong> (300+ reviews)</span>

        <span class="bm-rating__sep" aria-hidden="true">·</span>

        <span class="bm-proofLine">
          <span class="bm-proofItem">
            <span class="bm-proofIco" aria-hidden="true">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                <path d="M8 7h8" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                <path d="M7 10h10" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                <path d="M6 13h12" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                <path d="M8 17h8" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
              </svg>
            </span>
            {proof1}
          </span>

          <span class="bm-proofDot" aria-hidden="true">·</span>

          <span class="bm-proofItem">
            <span class="bm-proofIco" aria-hidden="true">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                <path d="M6 7h12v10H6V7Z" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/>
                <path d="M8 10h8" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                <path d="M9 14h6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
              </svg>
            </span>
            Pay at shop
          </span>
        </span>
      </div>
    </section>

    <!-- RIGHT -->
    <aside class="bm-hero__media" aria-label="Hero stage + booking">
      <!-- ✅ stage is the photo AND contains the booking card -->
      <div
        class="bm-hero__stage"
        style={`--bm-hero-photo: url("${photoUrl}"); --bm-hero-texture: url("${textureUrl}")`}
      >
        <div class="bm-booking" aria-label="Booking card">
          <div class="bm-booking__top">
            <div class="bm-booking__title">Book in seconds</div>
            <div class="bm-booking__pill">No app</div>
          </div>

          <div class="bm-bookingMeta" aria-label="Selected service meta">
            <span class="bm-bookingMeta__dot" aria-hidden="true"></span>
            <span data-bm-svcmeta>Skin fade · 50 min · £28</span>
          </div>

          <div class="bm-chips bm-chips--card" aria-label="Popular services">
            <button class="bm-chip is-active" type="button" data-bm-service="skinfade">
              Skin fade <strong>£28</strong>
            </button>
            <button class="bm-chip" type="button" data-bm-service="haircutbeard">
              Haircut + beard <strong>£30</strong>
            </button>
            <button class="bm-chip" type="button" data-bm-service="hottowel">
              Hot towel shave <strong>£18</strong>
            </button>
          </div>

          <div class="bm-slotTop">
            <span class="bm-slotTop__k">Times today</span>
            <span class="bm-slotTop__k bm-slotTop__soft">15 min slots</span>
          </div>

          <!-- ✅ carousel -->
          <div class="bm-timeCarousel" role="group" aria-label="Available times" data-bm-carousel>
            <div class="bm-timeCarousel__fade bm-timeCarousel__fade--l" aria-hidden="true"></div>
            <div class="bm-timeCarousel__fade bm-timeCarousel__fade--r" aria-hidden="true"></div>
            <div class="bm-timeCarousel__track" data-bm-track></div>
          </div>

          <a class="bm-bookBtn" href="#book" data-bm-confirm>
            Book 10:00 — Skin fade
            <span class="bm-bookBtn__sheen" aria-hidden="true"></span>
          </a>

          <p class="bm-bookHint">No payment required · cancel anytime</p>
        </div>
      </div>
    </aside>
  </div>

  <script is:inline>
    (function () {
      const root = document.querySelector("[data-bm-hero]");
      if (!root) return;

      const reduce =
        window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;

      // entrance
      if (!reduce) {
        try {
          const io = new IntersectionObserver(
            (entries) => entries.forEach((e) => e.isIntersecting && root.classList.add("is-in")),
            { threshold: 0.25 }
          );
          io.observe(root);
        } catch { root.classList.add("is-in"); }
      } else {
        root.classList.add("is-in");
      }

      // ===== time generation: 10:00 -> 19:45 (open until 20:00), step 15m =====
      const START = 10 * 60;
      const END = 20 * 60;
      const STEP = 15;

      const pad = (n) => String(n).padStart(2, "0");
      const fmt = (mins) => `${pad(Math.floor(mins / 60))}:${pad(mins % 60)}`;

      function buildTimes() {
        const out = [];
        for (let m = START; m < END; m += STEP) out.push(fmt(m));
        return out;
      }

      const allTimes = buildTimes();

      function computeSoonest() {
        const now = new Date();
        const cur = now.getHours() * 60 + now.getMinutes();

        if (cur < START) return fmt(START);
        if (cur >= END) return fmt(START);

        const rounded = Math.ceil(cur / STEP) * STEP;
        if (rounded >= END) return fmt(START);
        return fmt(rounded);
      }

      const soonestTime = computeSoonest();

      const services = {
        skinfade: { label: "Skin fade", mins: 50, price: "£28" },
        haircutbeard: { label: "Haircut + beard", mins: 60, price: "£30" },
        hottowel: { label: "Hot towel shave", mins: 30, price: "£18" },
      };

      const chipBtns = Array.from(root.querySelectorAll("[data-bm-service]"));
      const meta = root.querySelector("[data-bm-svcmeta]");
      const cta = root.querySelector("[data-bm-confirm]");

      const track = root.querySelector("[data-bm-track]");
      if (!track) return;

      let activeServiceKey = "skinfade";
      let activeTime = soonestTime;

      function setButtonText(aEl, text) {
        if (!aEl) return;
        const n = aEl.childNodes[0];
        if (n) n.textContent = text;
      }

      function updateCTAText() {
        const s = services[activeServiceKey];
        const text = `Book ${activeTime} — ${s.label}`;
        setButtonText(cta, text);
      }

      function setActiveTime(t) {
        activeTime = t;
        Array.from(track.querySelectorAll("[data-time]")).forEach((b) =>
          b.classList.toggle("is-active", b.getAttribute("data-time") === t)
        );
        updateCTAText();

        // keep active in view (smooth)
        const btn = track.querySelector(`[data-time="${t}"]`);
        if (btn && btn.scrollIntoView) {
          btn.scrollIntoView({ behavior: "smooth", inline: "center", block: "nearest" });
        }
      }

      function renderTimes() {
        track.innerHTML = "";
        allTimes.forEach((t) => {
          const b = document.createElement("button");
          b.type = "button";
          b.className =
            "bm-timeChip" +
            (t === soonestTime ? " is-soonest" : "") +
            (t === activeTime ? " is-active" : "");
          b.setAttribute("data-time", t);

          b.innerHTML = `
            ${t === soonestTime ? '<span class="bm-timeChip__badge">Soonest</span>' : ""}
            <span class="bm-timeChip__time">${t}</span>
          `;

          b.addEventListener("click", () => setActiveTime(t));
          track.appendChild(b);
        });

        // initial center on soonest
        requestAnimationFrame(() => setActiveTime(activeTime));
      }

      function renderService(key) {
        activeServiceKey = key;
        const s = services[key] || services.skinfade;

        chipBtns.forEach((b) => b.classList.toggle("is-active", b.getAttribute("data-bm-service") === key));

        if (meta) meta.textContent = `${s.label} · ${s.mins} min · ${s.price}`;
        updateCTAText();
      }

      chipBtns.forEach((btn) => {
        btn.addEventListener("click", () => renderService(btn.getAttribute("data-bm-service") || "skinfade"));
      });

      renderTimes();
      renderService(activeServiceKey);
      setActiveTime(activeTime);
    })();
  </script>
</main>
